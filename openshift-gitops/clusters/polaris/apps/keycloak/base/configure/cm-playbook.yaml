apiVersion: v1
kind: ConfigMap
metadata:
  name: rhbk-configure-playbook
data:
  rhbk-configure.yml: |
    - name: Configure RHBK
      hosts: local
      gather_facts: false
      vars:
        keycloak_url: "{{ lookup('env','KEYCLOAK_URL') }}"
        keycloak_admin_user: "{{ lookup('env','KEYCLOAK_ADMIN_USER') }}"
        keycloak_password: "{{ lookup('env','KEYCLOAK_PASSWORD') }}"
      tasks:
        - name: Wait for Keycloak API to respond (adjust path if needed)
          ansible.builtin.uri:
            url: "{{ keycloak_url }}/realms/master"
            method: GET
            validate_certs: true
          register: api
          until: api.status in [200, 401, 302]
          retries: 60
          delay: 5

        # Your redhat.rhbk tasks go here (realm/client/roles/etc)
